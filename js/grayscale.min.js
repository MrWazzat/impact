/*!
 * Start Bootstrap - ML CO2 Impact v5.0.8 ()
 * Copyright 2013-2020 
 * Licensed under MIT (https://github.com/BlackrockDigital/ml-co2-impact/blob/master/LICENSE)
 */

"use strict";function asyncGeneratorStep(e,t,o,n,r,i,a){try{var s=e[i](a),c=s.value}catch(e){return void o(e)}s.done?t(c):Promise.resolve(c).then(n,r)}function _asyncToGenerator(s){return function(){var e=this,a=arguments;return new Promise(function(t,o){var n=s.apply(e,a);function r(e){asyncGeneratorStep(n,t,o,r,i,"next",e)}function i(e){asyncGeneratorStep(n,t,o,r,i,"throw",e)}r(void 0)})}}function _createForOfIteratorHelper(e,t){var o;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(o=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){o=e[Symbol.iterator]()},n:function(){var e=o.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==o.return||o.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}var state,FEATURES=["gpu","provider","region","hours"];function getRandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function selectAndCopyText(e){if(document.selection)(t=document.body.createTextRange()).moveToElementText(document.getElementById(e)),t.select(),document.execCommand("copy");else if(window.getSelection){var t;(t=document.createRange()).selectNode(document.getElementById(e)),window.getSelection().removeAllRanges(),window.getSelection().addRange(t),document.execCommand("copy")}}function findGetParameter(t){var o=null,n=[];return location.search.substr(1).split("&").forEach(function(e){(n=e.split("="))[0]===t&&(o=decodeURIComponent(n[1]))}),o}function insertParam(e,t,o){t=encodeURI(t),o=encodeURI(o);for(var n,r=e.length;r--;)if((n=e[r].split("="))[0]==t){n[1]=o,e[r]=n.join("=");break}return r<0&&(e[e.length]=[t,o].join("=")),e}function sc(e){$("html,body").animate({scrollTop:$("#"+e).offset().top-parseInt($("#"+e).height()/1.2)},"slow")}var setImports=function(e,t,n){var r="dev"===e;$(t).each(function(e,t){var o=$(t).attr(n);o&&0<=o.indexOf("...")&&$(t).attr(n,r?o.split("...")[1]:"/impact"+o.split("...")[1])})},getValues=function(){var e=$("#compute-gpu option:selected").val(),t=$("#compute-number-gpu").val(),o=$("#compute-provider option:selected").val(),n="custom"!==o?$("#compute-region option:selected").val():null,r="custom"!==o?null:parseFloat($("#compute-custom-impact").val()),i="custom"!==o?null:parseFloat($("#compute-custom-offset").val());return{gpu:e,numberOfGpus:t,provider:o,region:n,hours:parseFloat($("#compute-hours").val()),customImpact:r,customOffset:i}},scrollToBottomResultCard=function(){var e=$("#result-card").offset().top+$("#result-card").outerHeight()-$(window).height()+50;$("html, body").animate({scrollTop:e},1e3,"easeInOutExpo")},growDivOnArrowClick=function(e,t){$(e).click(function(){if($(this).find(".arrow-icon").hasClass("open"))$(t).height(0),setTimeout(function(){isBottomVisible(50)||scrollToBottomResultCard()},500);else{var o=0;$(t).children().each(function(e,t){o+=$(t).innerHeight()}),$(t).height(o),setTimeout(function(){$(window).height()>$("#result-card").outerHeight()+150&&!isBottomVisible()&&scrollToBottomResultCard()},500)}$(this).find(".arrow-icon").toggleClass("open")})},growDivOnArrowClickLearn=function(e,t){$(e).click(function(){if($(this).find(".arrow-icon").hasClass("open"))$(this).siblings(t).height(0);else{var o=0;$(this).siblings(t).children().each(function(e,t){o+=$(t).innerHeight()}),$(this).siblings(t).height(o)}$(this).find(".arrow-icon").toggleClass("open")})},check=function(e,o){switch($("#compute-hours").css("border",""),e){case"gpu":return console.log(state.gpus,o),state.gpus.filter(function(e,t){return e.name===o}).length;case"hours":return Number.isInteger(o)&&0<o&&o<1e6;case"provider":return state.providers.filter(function(e,t){return e.name===o}).length;case"region":return state.regions.filter(function(e,t){return e.name===o}).length;default:return!0}},checkForm=function(){var e=getValues(),o=(e.gpu,e.provider,e.region,e.hours,!1);return FEATURES.forEach(function(e,t){check(t,e)||(fail(t),o=!0)}),o?null:e},twoDigits=function(e){return Number(Number(e).toFixed(2))},fillLatexTemplate=function(e,t,o,n,r,i,a,s){e?$("#template-text-offset").show():$("#template-text-offset").hide(),$("#template-provider").text(e||"a private infrastructure"),$("#template-region").text(t?"in region ".concat(t):""),$("#template-region-efficiency").text(s),$("#template-hours").text(o),$("#template-gpu").text(n),$("#template-gpu-power").text(r),$("#template-emissions").text(i),$("#template-percentage-offset").text(a)},setDetails=function(e){console.log({values:e});var t=140/17520,o=e.gpu,n=e.numberOfGpus,r=e.hours,i=e.provider,a=e.region,s=e.customImpact,c=e.customOffset,u=twoDigits(r*t*n),l=twoDigits(state.gpus[o].watt*n*r/1e3),p=Number.isFinite(s)?s:twoDigits(state.providers[i][a].impact/1e3),m=twoDigits(l*p+u),f=Number.isFinite(c)?twoDigits(m*c/100):twoDigits(m*state.providers[i][a].offsetRatio/100),d=Number.isFinite(c)?twoDigits(c):twoDigits(state.providers[i][a].offsetRatio),h=Number.isFinite(c)?"":state.providers[i][a].providerName,g=Number.isFinite(c)?"":state.providers[i].__min.region,v=Number.isFinite(c)?"":state.providers[i][g];if(fillLatexTemplate(h,a,r,o,state.gpus[o].watt,m,d,p),$("#flight-metric").text((m/523.4).toFixed(5)),$("#car-metric").text((m/2700*8e3).toFixed(3)),$("#emitted-value").text(m),$("#offset-value").text(f),$("#details-counts").html("\n  (".concat(state.gpus[o].watt,"W x ").concat(r,"h x ").concat(n,"gpus) = (<strong>").concat(l," kWh</strong> x ").concat(p," \n  kg  eq. CO<sub>2</sub>/kWh)\n   + (").concat(r,"h * ").concat(n,"gpus * ").concat(twoDigits(t)," kg  eq. CO<sub>2</sub>) \n   = <strong>").concat(m," kg eq. CO<sub>2</sub></strong>\n   ")),Number.isFinite(c))$("#details-min-region").html(""),$("#details-alternative").html(""),$("#details-alternative-content").show(),$("#compute-carbon-offset-title").html("Carbon offset");else if($("#compute-carbon-offset-title").html("Carbon Already Offset by Provider"),a!==g){var b=twoDigits(l*v.impact/1e3);$("#details-min-selected").hide(),$("#details-alternative").html("\n        Had this model been run in ".concat(h,"'s <strong>").concat(v.regionName,"</strong> region,\n        the carbon emitted would have been of <strong>").concat(b,"</strong> kg eq. CO<sub>2</sub>\n        ")),$("#details-alternative").show()}else $("#details-min-selected").show(),$("#details-alternative").hide(),$("#details-min-region").html("\n        You have selected ".concat(h,"'s cleanest region!\n        "))},isBottomVisible=function(e){var t=e||0;return $("#result-card").offset().top+$("#result-card").outerHeight()+t<$(window).scrollTop()+$(window).height()},submitCompute=function(e){$("#result-card").hide(),$("#details-content").height(0),$("#details-banner .arrow-icon").removeClass("open"),$(".spinner-border").show();var t=getValues();t&&(setDetails(t),state.current=t,setTimeout(function(){$(".spinner-border").hide(),$("#result-card").fadeIn(),$("#compute-carbon-emitted-title").height($("#compute-carbon-offset-title").height()),console.log($(window).scrollTop()+$(window).height()),($(window).width()<769||!isBottomVisible())&&scrollToBottomResultCard()},getRandomInt(500,1200)))},setRegions=function(e){if("custom"===e)$("#compute-region-div").fadeOut(function(){$(".custom-hidable").fadeIn()});else{$("#compute-region-div").is(":visible")||$(".custom-hidable").fadeOut(function(){$("#compute-region-div").fadeIn()}),$("#compute-region").html("");var t=[];for(var o in state.providers[e])if(state.providers[e].hasOwnProperty(o)&&"__min"!==o){var n=state.providers[e][o].regionName;n||(n=o),t.push({region:o,regionName:n})}t.sort(function(e,t){return e.regionName>t.regionName?1:t.regionName>e.regionName?-1:0});for(var r=0,i=t;r<i.length;r++){var a=i[r],s=a.regionName,c=a.region;$("#compute-region").append('<option value="'.concat(c,'">').concat(s,"</option>"))}}},setInputs=function(){var e,t,o=_createForOfIteratorHelper(Object.keys(state.gpus).sort());try{for(o.s();!(e=o.n()).done;){var n=e.value,r="Tesla V100"===n?"selected":"";$("#compute-gpu").append("<option ".concat(r,' value="').concat(n,'">').concat(n,"</option>"))}}catch(e){o.e(e)}finally{o.f()}var i=0;for(var a in state.providers)if(0==i&&(t=a),i++,state.providers.hasOwnProperty(a)){var s=void 0;for(var c in state.providers[a])if(state.providers[a].hasOwnProperty(c)&&"__min"!==c){s=state.providers[a][c].providerName;break}$("#compute-provider").append('<option value="'.concat(a,'">').concat(s,"</option>"))}$("#compute-provider").append('<option value="custom">Private Infrastructure</option>'),setRegions(t)};!function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(o){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o('a.js-scroll-trigger[href*="#"]:not([href="#"])').click(function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var e=o(this.hash);if((e=e.length?e:o("[name="+this.hash.slice(1)+"]")).length){o("html, body").animate({scrollTop:e.offset().top-70},1e3,"easeInOutExpo");var t=window.location.pathname;return"/"!==t[t.length-1]&&(t+="/"),window.history.pushState("","",t+this.hash),!1}}}),o(".js-scroll-trigger").click(function(){o(".navbar-collapse").collapse("hide")}),lozad().observe(),(t=function(){100<o("#mainNav").offset().top?o("#mainNav").addClass("navbar-shrink"):o("#mainNav").removeClass("navbar-shrink")})(),o(window).scroll(t),e.next=9,getData();case 9:state=e.sent,o("#compute-loader").fadeOut(function(){o("#compute-container").fadeIn()}),setInputs(),setImports(serveFrom,"a","href"),setImports(serveFrom,"img","src"),o("#compute-provider").change(function(e){var t=o("#compute-provider option:selected").val();setRegions(t)}),o("#compute-submit").click(function(){o("#compute-form").submit()}),o("#compute-form").submit(function(e){return submitCompute(),!1}),o(".details-summary").each(function(e,t){if(e%2==0||o(window).width()<770){o(t).append(o('\n      <a class="arrow-icon arrow-learn-even" title="Learn more">\n      <span class="left-bar"></span>\n      <span class="right-bar"></span>\n      </a>\n      '))}else{o(t).css("justify-content","flex-end"),o(t).prepend(o('\n      <a class="arrow-icon arrow-learn-odd" title="Learn more">\n      <span class="left-bar"></span>\n      <span class="right-bar"></span>\n      </a>\n      '))}}),growDivOnArrowClickLearn(".details-summary",".summary-content"),growDivOnArrowClick("#details-banner","#details-content"),o("#copy-template-btn").click(function(){selectAndCopyText("template-code"),o("#copy-template-feedback").fadeIn(function(){setTimeout(function(){o("#copy-template-feedback").fadeOut()},1e3)})});case 21:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()(jQuery);